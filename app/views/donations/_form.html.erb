<%= form_for @donation, :html => { :id => 'payment-form' } do |f| %>

  <%= f.label :name, "Name:" %>
  <%= f.text_field :name, id: "name", :placeholder => "John Doe" %>

  <%= f.label :email, "Email:" %>
  <%= f.text_field :email, id: "email", :placeholder => "you@example.com" %>

  <%= f.label :amount, "Amount:" %>
  <%= f.text_field :amount, id: "amount", :placeholder => "100" %><br>

  <label for="email">Card Number:</label>
  <input id="number" type="text" required="required" size="20" data-stripe="number" placeholder="**** **** **** ****" pattern="[\d ]*">
  <div>
    <div>
      <label for="cvc">CVC:</label>
      <input id="cvc" type="text" name="cvc" data-stripe="cvc" placeholder="***" required="required" pattern="\d*"/>
    </div>
    <div>
      <div>
        <div>
          <label for="exp-month">EXP&nbsp;(MM):</label>
          <input id="exp-month" data-stripe="exp-month" placeholder="MM" required="required" size="2" pattern="\d*"/>
        </div>
        <div>
          <label for="exp=year">(YYYY):</label>
          <input id="exp-year" data-stripe="exp-year" placeholder="YYYY" size="4" required="required" pattern="\d*"/>
        </div>
      </div>
    </div>
  </div>

  <button type="submit">Donate!</button>
  
<% end %>

<script type="text/javascript" src="https://js.stripe.com/v2/"></script>

<script type="text/javascript">
  $(function(){
    Stripe.setPublishableKey('<%= Rails.configuration.stripe[:publishable_key] %>');

  $('#payment-form').submit(function(event) {
    var $form = $(this);
    $form.find('button').prop('disabled', true);

    Stripe.card.createToken($form, stripeResponseHandler);
    return false;
  });

  function stripeResponseHandler(status, response) {
    var $form = $('#payment-form');
    if (response.error) {
      $form.find('.payment-errors').text(response.error.message);
      $form.find('button').prop('disabled', false);
    } else {
      var token = response.id;
      $form.append($('<input type="hidden" name="stripeToken">').val(token));
      $form.get(0).submit();
    }
  }

  });

</script>

